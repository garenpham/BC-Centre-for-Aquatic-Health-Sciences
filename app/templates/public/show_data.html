{% extends "public/templates/public_template.html" %}

{% block title %}Home{% endblock %}

{% block main %}
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.css">
<script src="http://code.jquery.com/jquery-1.11.2.min.js" type="text/javascript"></script>
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
<div class="container ">
  <div class="row">
    <div class="col">
    <h1>Data</h1>
    <hr>
        {% with messages = get_flashed_messages(with_categories=true) %}
            <!-- Categories: success (green), info (blue), warning (yellow), danger (red) -->
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }} alert-dismissible" role="alert">
                    {{ message }}
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span></button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
            <table id="show_data_table" class="table table-striped table-bordered table-sm" cellspacing="0" width="100%">
                <thead>
                <tr>
                    {% for header in headers %}
                    <th>{{header}}</th>
                    {% endfor %}
                    <th></th>
                </tr>
                </thead>
                <tbody>
                    {% for row in data %}
                        <tr>
                        {% for cell in row %}
                            <td>{{ cell }}</td>
                        {% endfor %}
                            {% set custom_row_variable = (row[0]|string).strip( )%}
                            <td class="text-center">
                                <form action="/display_data" method="post">
                                    <input type="hidden" name="sample_id" value={{ row[0] }}>
                                    <ul class="list-inline m-0">
                                        <!-- <li class="list-inline-item">
                                            <button class="btn btn-primary" type="button" title="Add">Add<i class="glyphicon glyphicon-plus"></i></button>
                                        </li> -->
                                        <!-- <li class="list-inline-item">
                                            <button class="btn btn-warning" data-toggle="modal" data-target="#Edit{{custom_row_variable}}ButtonModal"><i class="bi-pencil"></i></button>
                                        </li> -->
                                        {% if user_role == "admin" %}
                                        <li class="list-inline-item">
                                            <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#Delete{{custom_row_variable}}ButtonModal"><i class="bi-trash"></i></button>
                                        </li>
                                        {% endif %}
                                    </ul>
                                    {%if user_role == "admin" %}
                                    <div class="modal fade" id="Delete{{custom_row_variable}}ButtonModal" tabindex="-1" role="dialog" aria-labelledby="DeleteModalLabel" aria-hidden="true">
                                        <div class="modal-dialog" role="document">
                                          <div class="modal-content">
                                            <div class="modal-header">
                                              <h5 class="modal-title" id="DeleteModalLabel">Confirm Deletion</h5>
                                              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                              </button>
                                            </div>
                                            <div class="modal-body">
                                              <p class="btn-danger">
                                                Warning: This will delete all other dependant data!!!
                                                <br>Are you sure you would like to delete row:
                                                <br> {{headers[0]}} of : {{row[0]}} ?
                                              </p>
                                            </div>
                                            <div class="modal-footer">
                                              <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                              <button type="submit" name="submit_button" value="submit_delete{{headers[0]}}" class="btn btn-danger">Delete</button>
                                            </div>
                                          </div>
                                        </div>
                                      </div>
                                      {% endif %}
                                      <!-- <div class="modal fade" id="Edit{{custom_row_variable}}ButtonModal" tabindex="-1" role="dialog" aria-labelledby="EditModalLabel" aria-hidden="true">
                                        <div class="modal-dialog" role="document">
                                          <div class="modal-content">
                                            <div class="modal-header">
                                              <h5 class="modal-title" id="EditModalLabel">Edit the file</h5>
                                              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                              </button>
                                            </div>
                                            <div class="modal-body">
                                              <input type="hidden" class="form-control" name="Sample ID" id="Sample ID" placeholder="Sample_ID" value="{{row[0]}}">
                                              <input type="text" class="form-control" name="CAHS Submission Number" id="CAHS Submission Number" placeholder="CAHS Submission Number" value="{{row[3]}}" required> 
                                              <label>CAHS Submission Number</label><br>
                                              <input type="text" class="form-control" name="Sample Type" id="Sample Type" placeholder="Sample Type" value="{{row[7]}}" required>
                                              <label>Sample Type</label><br>
                                              <input type="text" class="form-control" name="Sample location" id="Sample location" placeholder="Sample location" value="{{row[8]}}" required>
                                              <label>Sample location</label><br>

                                              <input type="number" class="form-control" name="Water Temperature (c)" id="Water Temperature (c)" placeholder="Water Temperature (c)" value="{{row[4]}}">
                                              <label>Water Temperature (c)</label><br>
                                              <input type="number" min="0" class="form-control" name="Oxygen (mg/L)" id="Oxygen (mg/L)" placeholder="Oxygen (mg/L)" value="{{row[5]}}">
                                              <label>Oxygen (mg/L)</label><br>
                                              <input type="number" min="0" class="form-control" name="Saturation (%)" id="Saturation (%)" placeholder="Saturation (%)" value="{{row[6]}}">
                                              <label>Saturation (%)</label><br>

                                              <input type="number" step="1" min="0" name="Location ID" class="form-control" id="Location ID" placeholder="Location ID in Database" value="" required>
                                              <label>Location ID</label>
                                            </div>
                                            <div class="modal-footer">
                                              <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                              <button type="submit" name="submit_button" value="submit_edit{{headers[0]}}" class="btn btn-warning">Save Changes</button>
                                            </div>
                                          </div>
                                        </div>
                                      </div> -->
                                </form>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
            <form action="/display_data" method="post">
              <button type="submit" class="btn btn-primary" name="submit_button" value="sample_info">Sample Information</button>
              <button type="submit" class="btn btn-primary" name="submit_button" value="location_data">Location Data</button>
              <button type="submit" class="btn btn-primary" name="submit_button" value="submission_data">Submission Data</button>
              <button type="submit" class="btn btn-primary" name="submit_button" value="sample_data">Sample Data</button>
            </form>
    </div>
  </div>
</div>


<script>
    let table = new DataTable('#show_data_table', {
        // options
        buttons: [
        'copy', 'excel', 'pdf'
    ]
    });
 
</script>
{% endblock %}
